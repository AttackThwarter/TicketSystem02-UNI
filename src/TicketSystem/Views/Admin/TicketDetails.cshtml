@model TicketSystem.ViewModels.AdminTicketDetailsViewModel
@{
    ViewData["Title"] = "Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª";
}

<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="AllTickets">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</a></li>
            <li class="breadcrumb-item active">Ø¯Ø±Ø®ÙˆØ§Ø³Øª #@Model.Id</li>
        </ol>
    </nav>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle me-2"></i>@TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-circle me-2"></i>@TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row">
        <!-- Ø³ØªÙˆÙ† Ø§ØµÙ„ÛŒ -->
        <div class="col-lg-8">
            <!-- Ú©Ø§Ø±Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÛŒÚ©Øª -->
            <div class="card shadow mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-ticket-detailed me-2"></i>@Model.Title</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3 p-3 bg-light rounded">
                        <p class="mb-0" style="white-space: pre-wrap;">@Model.Description</p>
                    </div>
                    <small class="text-muted">
                        <i class="bi bi-calendar me-1"></i>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª: @Model.CreatedAt.ToString("yyyy/MM/dd HH:mm")
                    </small>
                </div>
            </div>

            <!-- Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-chat-dots me-2"></i>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ (@Model.Replies.Count)</h6>
                </div>
                <div class="card-body">
                    @if (Model.Replies.Any())
                    {
                        @foreach (var reply in Model.Replies)
                        {
                            <div class="d-flex mb-3 @(reply.IsAdminReply ? "justify-content-start" : "justify-content-end")">
                                <div class="card @(reply.IsAdminReply ? "bg-primary text-white" : "bg-light") p-3" 
                                     style="max-width: 80%; border-radius: 15px;">
                                    <small class="fw-bold">
                                        @(reply.IsAdminReply ? "ğŸ‘¨â€ğŸ’¼ Ù¾Ø§Ø³Ø® Ù…Ø¯ÛŒØ±" : "ğŸ‘¤ Ù¾Ø§Ø³Ø® Ú©Ø§Ø±Ø¨Ø±")
                                    </small>
                                    <p class="mb-1" style="white-space: pre-wrap;">@reply.Message</p>
                                    <small class="@(reply.IsAdminReply ? "text-white-50" : "text-muted")">
                                        @reply.CreatedAt.ToString("yyyy/MM/dd HH:mm")
                                    </small>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center">Ù‡Ù†ÙˆØ² Ù¾Ø§Ø³Ø®ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>
                    }
                </div>
            </div>

            <!-- ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ø§Ø¯Ù…ÛŒÙ† -->
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0"><i class="bi bi-reply me-2"></i>Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®</h6>
                </div>
                <div class="card-body">
                    <form asp-action="AdminReply" asp-route-id="@Model.Id" method="post">
                        @Html.AntiForgeryToken()
                        <div class="mb-3">
                            <textarea name="message" class="form-control" rows="4" 
                                      placeholder="Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-send me-1"></i>Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ø³ØªÙˆÙ† Ú©Ù†Ø§Ø±ÛŒ -->
        <div class="col-lg-4">
            <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± -->
            <div class="card shadow mb-4">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-person me-2"></i>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±</h6>
                </div>
                <div class="card-body">
                    <p><strong>Ù†Ø§Ù…:</strong> @Model.UserFullName</p>
                    <p><strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> @Model.UserEmail</p>
                </div>
            </div>

            <!-- ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª -->
            <div class="card shadow">
                <div class="card-header">
                    <h6 class="mb-0"><i class="bi bi-gear me-2"></i>ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª</h6>
                </div>
                <div class="card-body">
                    @{
                        var currentBadgeClass = Model.Status switch
                        {
                            "Open" => "bg-warning text-dark",
                            "InProgress" => "bg-info",
                            "Closed" => "bg-success",
                            _ => "bg-secondary"
                        };
                        var currentStatusText = Model.Status switch
                        {
                            "Open" => "Ø¨Ø§Ø²",
                            "InProgress" => "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ",
                            "Closed" => "Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡",
                            _ => Model.Status
                        };
                    }
                    <p>ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ: <span class="badge @currentBadgeClass">@currentStatusText</span></p>
                    
                    <form asp-action="ChangeStatus" asp-route-id="@Model.Id" method="post">
                        @Html.AntiForgeryToken()
                        <div class="mb-3">
                            <select name="newStatus" class="form-select">
                                <option value="Open" selected="@(Model.Status == "Open")">Ø¨Ø§Ø²</option>
                                <option value="InProgress" selected="@(Model.Status == "InProgress")">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ</option>
                                <option value="Closed" selected="@(Model.Status == "Closed")">Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-warning w-100">
                            <i class="bi bi-arrow-repeat me-1"></i>ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
